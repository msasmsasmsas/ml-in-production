# Конфігурація Kubernetes для розгортання API моделі

## Опіс проєкту

Цей проєкт містить конфігураційні файли Kubernetes для розгортання API сервісу моделі розпізнавання загроз сільськогосподарським культурам. Конфігурація забезпечує масштабоване, надійне та відмовостійке розгортання з можливістю автоматичного масштабування залежно від навантаження.

## Компоненти Kubernetes

### Deployment

Основний компонент, що визначає бажаний стан розгортання. Конфігурація включає:
- 3 репліки для забезпечення високої доступності
- Стратегію поступового оновлення (Rolling Update)
- Налаштування ресурсів (CPU, пам'ять)
- Проби готовності та живучості для моніторингу стану контейнерів

### Service

Забезпечує стабільну мережеву точку доступу до API. Конфігурація включає:
- Тип ClusterIP для внутрішнього доступу
- Перенаправлення з порту 80 на порт 8000 додатка

### HorizontalPodAutoscaler (HPA)

Автоматично масштабує кількість подів залежно від навантаження:
- Мінімально 3 репліки
- Максимально 10 реплік
- Масштабування на основі використання CPU та пам'яті

### PersistentVolumeClaim (PVC)

Забезпечує постійне зберігання для файлів моделі:
- Обсяг зберігання 1Gi
- Режим доступу ReadWriteOnce

### Ingress

Налаштовує зовнішній доступ до API:
- Маршрутизація на основі доменного імені
- Налаштування для обробки великих завантажень файлів (до 10MB)

## Інструкція з розгортання

1. Створіть namespace для ML-сервісів:
   ```
   kubectl create namespace ml-serving
   ```

2. Застосуйте конфігураційні файли:
   ```
   kubectl apply -f deployment.yaml
   ```

3. Перевірте статус розгортання:
   ```
   kubectl get pods -n ml-serving
   kubectl get services -n ml-serving
   kubectl get hpa -n ml-serving
   ```

## Стратегія розгортання

У конфігурації використовується стратегія Rolling Update, яка забезпечує:
- Поступове оновлення сервісу без простоїв
- Можливість відкату при виявленні проблем
- Контроль навантаження при оновленні (maxSurge, maxUnavailable)

## Налаштування масштабування

HorizontalPodAutoscaler налаштований для автоматичного масштабування на основі:
- Середнє використання CPU > 70%
- Середнє використання пам'яті > 80%

Це дозволяє ефективно обробляти збільшення навантаження під час пікового використання.

## Моніторинг

Для моніторингу стану розгортання рекомендується використовувати:
- kubectl для перевірки стану подів та сервісів
- Prometheus для збору метрик
- Grafana для візуалізації метрик та налаштування сповіщень

## Dockerfile

Включений Dockerfile визначає процес створення контейнера для API сервісу, включаючи:
- Використання офіційного образу Python
- Встановлення необхідних залежностей
- Налаштування безпеки (використання непривілейованого користувача)
- Оптимізацію розміру контейнера
